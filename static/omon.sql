-- ===================== MIGRATION (SQLite) =====================
PRAGMA foreign_keys = ON;
PRAGMA journal_mode = WAL;
PRAGMA synchronous = NORMAL;

BEGIN IMMEDIATE;

-- ---------- drop old triggers/indexes ----------
DROP TRIGGER IF EXISTS trg_codes_block_ukrf_ins;
DROP TRIGGER IF EXISTS trg_codes_block_ukrf_upd;
DROP TRIGGER IF EXISTS trg_codes_block_ukrf_del;
DROP TRIGGER IF EXISTS trg_codes_limit_per_chat_ins;
DROP TRIGGER IF EXISTS trg_codes_limit_per_chat_upd;
DROP TRIGGER IF EXISTS trg_sentences_limit_per_code_ins;
DROP TRIGGER IF EXISTS trg_sentences_limit_per_code_upd;

DROP INDEX IF EXISTS unq_codes_null_chat;
DROP INDEX IF EXISTS idx_codes_chat_id;
DROP INDEX IF EXISTS idx_sentences_code_id;
DROP INDEX IF EXISTS idx_sentences_code_name;

-- ---------- new schema ----------
CREATE TABLE IF NOT EXISTS codes_new (
  id        INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
  chat_id   INTEGER,
  code_name TEXT NOT NULL
    CHECK (code_name = lower(trim(code_name)))
    CHECK (code_name GLOB '[a-z][a-z]*')
    CHECK (length(code_name) BETWEEN 1 AND 32),
  CONSTRAINT unq_codes_chat_code UNIQUE (chat_id, code_name)
);

CREATE TABLE IF NOT EXISTS codes_sentences_new (
  id                   INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
  code_id              INTEGER NOT NULL,
  sentence_name        TEXT NOT NULL
    CHECK (sentence_name = trim(sentence_name))
    CHECK (length(sentence_name) BETWEEN 1 AND 64),
  sentence_description TEXT NOT NULL
    CHECK (sentence_description = trim(sentence_description))
    CHECK (length(sentence_description) BETWEEN 1 AND 4096),
  CONSTRAINT unq_sentences UNIQUE (code_id, sentence_name),
  CONSTRAINT fk_codes_sentences_code
    FOREIGN KEY(code_id) REFERENCES codes_new(id) ON DELETE CASCADE
);

-- ---------- copy & normalize ----------
-- игнорируем ukrf, если он был создан с ненулевым chat_id (схема сама добавит дефолт позже)
INSERT INTO codes_new(id, chat_id, code_name)
SELECT id, chat_id, lower(trim(code_name))
FROM   codes
WHERE  NOT (lower(trim(code_name))='ukrf' AND chat_id IS NOT NULL);

-- только непросиротевшие статьи
INSERT INTO codes_sentences_new(id, code_id, sentence_name, sentence_description)
SELECT s.id, s.code_id, trim(s.sentence_name), trim(s.sentence_description)
FROM   codes_sentences s
JOIN   codes_new c ON c.id = s.code_id;

-- ---------- validate existing data (single summed assertion) ----------
CREATE TEMP TABLE _assert(x INTEGER CHECK (x=0));

CREATE TEMP VIEW _violations(v) AS
  -- некорректные code_name
  SELECT COUNT(*) FROM codes_new
   WHERE code_name IS NULL
      OR code_name NOT GLOB '[a-z][a-z]*'
      OR length(code_name) NOT BETWEEN 1 AND 32
UNION ALL
  -- лимит: не более 10 кодексов на чат
  SELECT COUNT(*) FROM (
    SELECT chat_id, COUNT(*) n
    FROM codes_new
    WHERE chat_id IS NOT NULL
    GROUP BY chat_id
    HAVING n > 10
  )
UNION ALL
  -- длины статей/описаний
  SELECT COUNT(*) FROM codes_sentences_new
   WHERE length(sentence_name) NOT BETWEEN 1 AND 64
      OR length(sentence_description) NOT BETWEEN 1 AND 4096
UNION ALL
  -- лимит: не более 500 статей на кодекс
  SELECT COUNT(*) FROM (
    SELECT code_id, COUNT(*) n
    FROM codes_sentences_new
    GROUP BY code_id
    HAVING n > 500
  );

-- если сумма нарушений > 0 — падаем
INSERT INTO _assert
SELECT IFNULL(SUM(v),0) FROM _violations;

-- ---------- swap ----------
ALTER TABLE codes            RENAME TO codes_old;
ALTER TABLE codes_sentences  RENAME TO codes_sentences_old;

ALTER TABLE codes_new            RENAME TO codes;
ALTER TABLE codes_sentences_new  RENAME TO codes_sentences;

DROP TABLE codes_old;
DROP TABLE codes_sentences_old;

-- ---------- indexes ----------
CREATE UNIQUE INDEX IF NOT EXISTS unq_codes_null_chat
  ON codes(code_name) WHERE chat_id IS NULL;

CREATE INDEX IF NOT EXISTS idx_codes_chat_id       ON codes(chat_id);
CREATE INDEX IF NOT EXISTS idx_sentences_code_id   ON codes_sentences(code_id);
CREATE INDEX IF NOT EXISTS idx_sentences_code_name ON codes_sentences(code_id, sentence_name);

-- ---------- triggers ----------
-- reserved 'ukrf'
CREATE TRIGGER IF NOT EXISTS trg_codes_block_ukrf_ins
BEFORE INSERT ON codes
FOR EACH ROW
WHEN NEW.code_name = 'ukrf' AND NEW.chat_id IS NOT NULL
BEGIN
  SELECT RAISE(ABORT, 'code_name ukrf is reserved for default (NULL chat)');
END;

CREATE TRIGGER IF NOT EXISTS trg_codes_block_ukrf_upd
BEFORE UPDATE OF chat_id, code_name ON codes
FOR EACH ROW
WHEN (OLD.code_name = 'ukrf' AND OLD.chat_id IS NULL AND NEW.chat_id IS NOT NULL)
   OR (OLD.code_name = 'ukrf' AND NEW.code_name <> 'ukrf')
   OR (NEW.code_name = 'ukrf' AND NEW.chat_id IS NOT NULL)
BEGIN
  SELECT RAISE(ABORT, 'default ukrf is immutable and reserved');
END;

CREATE TRIGGER IF NOT EXISTS trg_codes_block_ukrf_del
BEFORE DELETE ON codes
FOR EACH ROW
WHEN OLD.code_name = 'ukrf' AND OLD.chat_id IS NULL
BEGIN
  SELECT RAISE(ABORT, 'default ukrf cannot be deleted');
END;

-- per-chat limit 10
CREATE TRIGGER IF NOT EXISTS trg_codes_limit_per_chat_ins
BEFORE INSERT ON codes
FOR EACH ROW
WHEN NEW.chat_id IS NOT NULL
 AND (SELECT COUNT(*) FROM codes c WHERE c.chat_id = NEW.chat_id) >= 10
BEGIN
  SELECT RAISE(ABORT, 'codes per chat limit reached');
END;

CREATE TRIGGER IF NOT EXISTS trg_codes_limit_per_chat_upd
BEFORE UPDATE OF chat_id ON codes
FOR EACH ROW
WHEN NEW.chat_id IS NOT NULL
 AND (SELECT COUNT(*) FROM codes c WHERE c.chat_id = NEW.chat_id) >= 10
BEGIN
  SELECT RAISE(ABORT, 'codes per chat limit reached');
END;

-- per-code sentences limit 500
CREATE TRIGGER IF NOT EXISTS trg_sentences_limit_per_code_ins
BEFORE INSERT ON codes_sentences
FOR EACH ROW
WHEN (SELECT COUNT(*) FROM codes_sentences s WHERE s.code_id = NEW.code_id) >= 500
BEGIN
  SELECT RAISE(ABORT, 'sentences per code limit reached');
END;

CREATE TRIGGER IF NOT EXISTS trg_sentences_limit_per_code_upd
BEFORE UPDATE OF code_id ON codes_sentences
FOR EACH ROW
WHEN (SELECT COUNT(*) FROM codes_sentences s WHERE s.code_id = NEW.code_id) >= 500
BEGIN
  SELECT RAISE(ABORT, 'sentences per code limit reached');
END;

-- ---------- default data ----------
INSERT OR IGNORE INTO codes(chat_id, code_name) VALUES (NULL, 'ukrf');

WITH cid AS (
  SELECT id FROM codes WHERE chat_id IS NULL AND code_name = 'ukrf'
),
data(sentence_name, sentence_description) AS (
  VALUES

    ("105", "Убийство"),
    ("106", "Убийство матерью новорожденного ребенка"),
    ("107", "Убийство, совершенное в состоянии аффекта"),
    ("108", "Убийство, совершенное при превышении пределов необходимой обороны либо при превышении мер, необходимых для задержания лица, совершившего преступление"),
    ("109", "Причинение смерти по неосторожности"),
    ("110", "Доведение до самоубийства"),
    ("111", "Умышленное причинение тяжкого вреда здоровью"),
    ("112", "Умышленное причинение средней тяжести вреда здоровью"),
    ("113", "Причинение тяжкого или средней тяжести вреда здоровью в состоянии аффекта"),
    ("114", "Причинение тяжкого или средней тяжести вреда здоровью при превышении пределов необходимой обороны либо при превышении мер, необходимых для задержания лица, совершившего преступление"),
    ("115", "Умышленное причинение легкого вреда здоровью"),
    ("116", "Побои"),
    ("117", "Истязание"),
    ("118", "Причинение тяжкого вреда здоровью по неосторожности"),
    ("119", "Угроза убийством или причинением тяжкого вреда здоровью"),
    ("120", "Принуждение к изъятию органов или тканей человека для трансплантации"),
    ("121", "Заражение венерической болезнью"),
    ("122", "Заражение ВИЧ-инфекцией"),
    ("123", "Незаконное проведение искусственного прерывания беременности"),
    ("124", "Неоказание помощи больному"),
    ("125", "Оставление в опасности"),
    ("126", "Похищение человека"),
    ("127", "Незаконное лишение свободы"),
    ("128", "Незаконная госпитализация в медицинскую организацию, оказывающую психиатрическую помощь в стационарных условиях"),
    ("131", "Изнасилование"),
    ("132", "Насильственные действия сексуального характера"),
    ("133", "Понуждение к действиям сексуального характера"),
    ("134", "Половое сношение и иные действия сексуального характера с лицом, не достигшим шестнадцатилетнего возраста"),
    ("135", "Развратные действия"),
    ("136", "Нарушение равенства прав и свобод человека и гражданина"),
    ("137", "Нарушение неприкосновенности частной жизни"),
    ("138", "Нарушение тайны переписки, телефонных переговоров, почтовых, телеграфных или иных сообщений"),
    ("139", "Нарушение неприкосновенности жилища"),
    ("140", "Отказ в предоставлении гражданину информации"),
    ("141", "Воспрепятствование осуществлению избирательных прав или работе избирательных комиссий"),
    ("142", "Фальсификация избирательных документов, документов референдума, документов общероссийского голосования"),
    ("143", "Нарушение требований охраны труда"),
    ("144", "Воспрепятствование законной профессиональной деятельности журналистов"),
    ("145", "Необоснованный отказ в приеме на работу или необоснованное увольнение беременной женщины или женщины, имеющей детей в возрасте до трех лет"),
    ("146", "Нарушение авторских и смежных прав"),
    ("147", "Нарушение изобретательских и патентных прав"),
    ("148", "Нарушение права на свободу совести и вероисповеданий"),
    ("149", "Воспрепятствование проведению собрания, митинга, демонстрации, шествия, пикетирования или участию в них"),
    ("150", "Вовлечение несовершеннолетнего в совершение преступления"),
    ("151", "Вовлечение несовершеннолетнего в совершение антиобщественных действий"),
    ("153", "Подмена ребенка"),
    ("154", "Незаконное усыновление (удочерение)"),
    ("155", "Разглашение тайны усыновления (удочерения)"),
    ("156", "Неисполнение обязанностей по воспитанию несовершеннолетнего"),
    ("157", "Неуплата средств на содержание детей или нетрудоспособных родителей"),
    ("158", "Кража"),
    ("159", "Мошенничество"),
    ("160", "Присвоение или растрата"),
    ("161", "Грабеж"),
    ("162", "Разбой"),
    ("163", "Вымогательство"),
    ("164", "Хищение предметов, имеющих особую ценность"),
    ("165", "Причинение имущественного ущерба путем обмана или злоупотребления доверием"),
    ("166", "Неправомерное завладение автомобилем или иным транспортным средством без цели хищения"),
    ("167", "Умышленные уничтожение или повреждение имущества"),
    ("168", "Уничтожение или повреждение имущества по неосторожности"),
    ("169", "Воспрепятствование законной предпринимательской или иной деятельности"),
    ("170", "Регистрация незаконных сделок с недвижимым имуществом"),
    ("171", "Незаконное предпринимательство"),
    ("172", "Незаконная банковская деятельность"),
    ("174", "Легализация (отмывание) денежных средств или иного имущества, приобретенных другими лицами преступным путем"),
    ("175", "Приобретение или сбыт имущества, заведомо добытого преступным путем"),
    ("176", "Незаконное получение кредита"),
    ("177", "Злостное уклонение от погашения кредиторской задолженности"),
    ("178", "Ограничение конкуренции"),
    ("179", "Принуждение к совершению сделки или к отказу от ее совершения"),
    ("180", "Незаконное использование средств индивидуализации товаров (работ, услуг)"),
    ("181", "Нарушение правил изготовления и использования государственных пробирных клейм"),
    ("183", "Незаконные получение и разглашение сведений, составляющих коммерческую, налоговую или банковскую тайну"),
    ("184", "Оказание противоправного влияния на результат официального спортивного соревнования или зрелищного коммерческого конкурса"),
    ("185", "Злоупотребления при эмиссии ценных бумаг"),
    ("186", "Изготовление, хранение, перевозка или сбыт поддельных денег или ценных бумаг"),
    ("187", "Неправомерный оборот средств платежей"),
    ("189", "Незаконные экспорт из Российской Федерации или передача товаров или технологий, вооружения или военной техники, незаконное выполнение работ либо незаконное оказание услуг, в отношении которых установлен экспортный контроль"),
    ("190", "Невозвращение на территорию Российской Федерации культурных ценностей"),
    ("191", "Незаконный оборот янтаря, нефрита или иных полудрагоценных камней, драгоценных металлов, драгоценных камней либо жемчуга"),
    ("192", "Нарушение правил сдачи государству драгоценных металлов и драгоценных камней"),
    ("193", "Уклонение от исполнения обязанностей по репатриации денежных средств в иностранной валюте или валюте Российской Федерации"),
    ("194", "Уклонение от уплаты таможенных платежей, специальных, антидемпинговых и (или) компенсационных пошлин, взимаемых с организации или физического лица"),
    ("195", "Неправомерные действия при банкротстве"),
    ("196", "Преднамеренное банкротство"),
    ("197", "Фиктивное банкротство"),
    ("198", "Уклонение физического лица от уплаты налогов, сборов и (или) физического лица - плательщика страховых взносов от уплаты страховых взносов"),
    ("199", "Уклонение от уплаты налогов, сборов, подлежащих уплате организацией, и (или) страховых взносов, подлежащих уплате организацией - плательщиком страховых взносов"),
    ("201", "Злоупотребление полномочиями"),
    ("202", "Злоупотребление полномочиями частными нотариусами и аудиторами"),
    ("203", "Превышение полномочий частным детективом или работником частной охранной организации, имеющим удостоверение частного охранника, при выполнении ими своих должностных обязанностей"),
    ("204", "Коммерческий подкуп"),
    ("205", "Террористический акт"),
    ("206", "Захват заложника"),
    ("207", "Заведомо ложное сообщение об акте терроризма"),
    ("208", "Организация незаконного вооруженного формирования или участие в нем, а равно участие в вооруженном конфликте или военных действиях в целях, противоречащих интересам Российской Федерации"),
    ("209", "Бандитизм"),
    ("210", "Организация преступного сообщества (преступной организации) или участие в нем (ней)"),
    ("211", "Угон судна воздушного или водного транспорта либо железнодорожного подвижного состава"),
    ("212", "Массовые беспорядки"),
    ("213", "Хулиганство"),
    ("214", "Вандализм"),
    ("215", "Нарушение правил безопасности на объектах атомной энергетики"),
    ("216", "Нарушение правил безопасности при ведении строительных или иных работ"),
    ("217", "Нарушение требований промышленной безопасности опасных производственных объектов"),
    ("218", "Нарушение правил учета, хранения, перевозки и использования взрывчатых, легковоспламеняющихся веществ и пиротехнических изделий"),
    ("219", "Нарушение требований пожарной безопасности"),
    ("220", "Незаконное обращение с ядерными материалами или радиоактивными веществами"),
    ("221", "Хищение либо вымогательство ядерных материалов или радиоактивных веществ"),
    ("222", "Незаконные приобретение, передача, сбыт, хранение, перевозка, пересылка или ношение оружия, основных частей огнестрельного оружия, боеприпасов"),
    ("223", "Незаконное изготовление оружия"),
    ("224", "Небрежное хранение огнестрельного оружия"),
    ("225", "Ненадлежащее исполнение обязанностей по охране оружия, боеприпасов, взрывчатых веществ и взрывных устройств"),
    ("226", "Хищение либо вымогательство оружия, боеприпасов, взрывчатых веществ и взрывных устройств"),
    ("227", "Пиратство"),
    ("228", "Незаконные приобретение, хранение, перевозка, изготовление, переработка наркотических средств, психотропных веществ или их аналогов, а также незаконные приобретение, хранение, перевозка растений, содержащих наркотические средства или психотропные вещества, либо их частей, содержащих наркотические средства или психотропные вещества"),
    ("229", "Хищение либо вымогательство наркотических средств или психотропных веществ, а также растений, содержащих наркотические средства или психотропные вещества, либо их частей, содержащих наркотические средства или психотропные вещества"),
    ("230", "Склонение к потреблению наркотических средств, психотропных веществ или их аналогов"),
    ("231", "Незаконное культивирование растений, содержащих наркотические средства или психотропные вещества либо их прекурсоры"),
    ("232", "Организация либо содержание притонов или систематическое предоставление помещений для потребления наркотических средств, психотропных веществ или их аналогов"),
    ("233", "Незаконная выдача либо подделка рецептов или иных документов, дающих право на получение наркотических средств или психотропных веществ"),
    ("234", "Незаконный оборот сильнодействующих или ядовитых веществ в целях сбыта"),
    ("235", "Незаконное осуществление медицинской деятельности или фармацевтической деятельности"),
    ("236", "Нарушение санитарно-эпидемиологических правил"),
    ("237", "Сокрытие информации об обстоятельствах, создающих опасность для жизни или здоровья людей"),
    ("238", "Производство, хранение, перевозка либо сбыт товаров и продукции, выполнение работ или оказание услуг, не отвечающих требованиям безопасности"),
    ("239", "Создание некоммерческой организации, посягающей на личность и права граждан"),
    ("240", "Вовлечение в занятие проституцией"),
    ("241", "Организация занятия проституцией"),
    ("242", "Незаконные изготовление и оборот порнографических материалов или предметов"),
    ("243", "Уничтожение или повреждение объектов культурного наследия (памятников истории и культуры) народов Российской Федерации, включенных в единый государственный реестр объектов культурного наследия (памятников истории и культуры) народов Российской Федерации, выявленных объектов культурного наследия, природных комплексов, объектов, взятых под охрану государства, или культурных ценностей"),
    ("244", "Надругательство над телами умерших и местами их захоронения"),
    ("245", "Жестокое обращение с животными"),
    ("246", "Нарушение правил охраны окружающей среды при производстве работ"),
    ("247", "Нарушение правил обращения экологически опасных веществ и отходов"),
    ("248", "Нарушение правил безопасности при обращении с микробиологическими либо другими биологическими агентами или токсинами"),
    ("249", "Нарушение ветеринарных правил и правил, установленных для борьбы с болезнями и вредителями растений"),
    ("250", "Загрязнение вод"),
    ("251", "Загрязнение атмосферы"),
    ("252", "Загрязнение морской среды"),
    ("253", "Нарушение законодательства Российской Федерации о континентальном шельфе и об исключительной экономической зоне Российской Федерации"),
    ("254", "Порча земли"),
    ("255", "Нарушение правил охраны и использования недр"),
    ("256", "Незаконная добыча (вылов) водных биологических ресурсов"),
    ("257", "Нарушение правил охраны водных биологических ресурсов"),
    ("258", "Незаконная охота"),
    ("259", "Уничтожение критических местообитаний для организмов, занесенных в Красную книгу Российской Федерации"),
    ("260", "Незаконная рубка лесных насаждений"),
    ("261", "Уничтожение или повреждение лесных насаждений"),
    ("262", "Нарушение режима особо охраняемых природных территорий и природных объектов"),
    ("263", "Нарушение правил безопасности движения и эксплуатации железнодорожного, воздушного, морского и внутреннего водного транспорта и метрополитена"),
    ("264", "Нарушение правил дорожного движения и эксплуатации транспортных средств"),
    ("266", "Недоброкачественный ремонт транспортных средств и выпуск их в эксплуатацию с техническими неисправностями"),
    ("267", "Приведение в негодность транспортных средств или путей сообщения"),
    ("268", "Нарушение правил, обеспечивающих безопасную работу транспорта"),
    ("270", "Неоказание капитаном судна помощи терпящим бедствие"),
    ("271", "Нарушение правил международных полетов"),
    ("272", "Неправомерный доступ к компьютерной информации"),
    ("273", "Создание, использование и распространение вредоносных компьютерных программ"),
    ("274", "Нарушение правил эксплуатации средств хранения, обработки или передачи компьютерной информации и информационно-телекоммуникационных сетей"),
    ("275", "Государственная измена"),
    ("276", "Шпионаж"),
    ("277", "Посягательство на жизнь государственного или общественного деятеля"),
    ("278", "Насильственный захват власти или насильственное удержание власти"),
    ("279", "Вооруженный мятеж"),
    ("280", "Публичные призывы к осуществлению экстремистской деятельности"),
    ("281", "Диверсия"),
    ("282", "Возбуждение ненависти либо вражды, а равно унижение человеческого достоинства"),
    ("283", "Разглашение государственной тайны"),
    ("284", "Утрата документов, содержащих государственную тайну"),
    ("285", "Злоупотребление должностными полномочиями"),
    ("286", "Превышение должностных полномочий"),
    ("287", "Отказ в предоставлении информации Федеральному Собранию Российской Федерации или Счетной палате Российской Федерации"),
    ("288", "Присвоение полномочий должностного лица"),
    ("289", "Незаконное участие в предпринимательской деятельности"),
    ("290", "Получение взятки"),
    ("291", "Дача взятки"),
    ("292", "Служебный подлог"),
    ("293", "Халатность"),
    ("294", "Воспрепятствование осуществлению правосудия и производству предварительного расследования"),
    ("295", "Посягательство на жизнь лица, осуществляющего правосудие или предварительное расследование"),
    ("296", "Угроза или насильственные действия в связи с осуществлением правосудия или производством предварительного расследования"),
    ("297", "Неуважение к суду"),
    ("299", "Привлечение заведомо невиновного к уголовной ответственности или незаконное возбуждение уголовного дела"),
    ("300", "Незаконное освобождение от уголовной ответственности"),
    ("301", "Незаконные задержание, заключение под стражу или содержание под стражей"),
    ("302", "Принуждение к даче показаний"),
    ("303", "Фальсификация доказательств и результатов оперативно-разыскной деятельности"),
    ("304", "Провокация взятки, коммерческого подкупа либо подкупа в сфере закупок товаров, работ, услуг для обеспечения государственных или муниципальных нужд"),
    ("305", "Вынесение заведомо неправосудных приговора, решения или иного судебного акта"),
    ("306", "Заведомо ложный донос"),
    ("307", "Заведомо ложные показание, заключение эксперта, специалиста или неправильный перевод"),
    ("308", "Отказ свидетеля или потерпевшего от дачи показаний"),
    ("309", "Подкуп или принуждение к даче показаний или уклонению от дачи показаний либо к неправильному переводу"),
    ("310", "Разглашение данных предварительного расследования"),
    ("311", "Разглашение сведений о мерах безопасности, применяемых в отношении судьи и участников уголовного процесса"),
    ("312", "Незаконные действия в отношении имущества, подвергнутого описи или аресту либо подлежащего конфискации"),
    ("313", "Побег из места лишения свободы, из-под ареста или из-под стражи"),
    ("314", "Уклонение от отбывания ограничения свободы, лишения свободы, а также от применения принудительных мер медицинского характера"),
    ("315", "Неисполнение приговора суда, решения суда или иного судебного акта"),
    ("316", "Укрывательство преступлений"),
    ("317", "Посягательство на жизнь сотрудника правоохранительного органа"),
    ("318", "Применение насилия в отношении представителя власти"),
    ("319", "Оскорбление представителя власти"),
    ("320", "Разглашение сведений о мерах безопасности, применяемых в отношении должностного лица правоохранительного или контролирующего органа"),
    ("321", "Дезорганизация деятельности учреждений, обеспечивающих изоляцию от общества"),
    ("322", "Незаконное пересечение Государственной границы Российской Федерации"),
    ("323", "Противоправное изменение Государственной границы Российской Федерации"),
    ("324", "Приобретение или сбыт официальных документов и государственных наград"),
    ("325", "Похищение или повреждение документов, штампов, печатей либо похищение акцизных марок, специальных марок или знаков соответствия"),
    ("326", "Подделка или уничтожение идентификационного номера транспортного средства"),
    ("327", "Подделка, изготовление или оборот поддельных документов, государственных наград, штампов, печатей или бланков"),
    ("328", "Уклонение от прохождения военной и альтернативной гражданской службы"),
    ("329", "Надругательство над Государственным гербом Российской Федерации или Государственным флагом Российской Федерации"),
    ("330", "Самоуправство"),
    ("331", "Понятие преступлений против военной службы"),
    ("332", "Неисполнение приказа"),
    ("333", "Сопротивление начальнику или принуждение его к нарушению обязанностей военной службы"),
    ("334", "Насильственные действия в отношении начальника"),
    ("335", "Нарушение уставных правил взаимоотношений между военнослужащими при отсутствии между ними отношений подчиненности"),
    ("336", "Оскорбление военнослужащего"),
    ("337", "Самовольное оставление части или места службы"),
    ("338", "Дезертирство"),
    ("339", "Уклонение от исполнения обязанностей военной службы путем симуляции болезни или иными способами"),
    ("340", "Нарушение правил несения боевого дежурства"),
    ("341", "Нарушение правил несения пограничной службы"),
    ("342", "Нарушение уставных правил караульной службы"),
    ("343", "Нарушение правил несения службы по охране общественного порядка и обеспечению общественной безопасности"),
    ("344", "Нарушение уставных правил несения внутренней службы и патрулирования в гарнизоне"),
    ("345", "Оставление погибающего военного корабля"),
    ("346", "Умышленные уничтожение или повреждение военного имущества"),
    ("347", "Уничтожение или повреждение военного имущества по неосторожности"),
    ("348", "Утрата военного имущества"),
    ("349", "Нарушение правил обращения с оружием и предметами, представляющими повышенную опасность для окружающих"),
    ("350", "Нарушение правил вождения или эксплуатации машин"),
    ("351", "Нарушение правил полетов или подготовки к ним"),
    ("352", "Нарушение правил кораблевождения"),
    ("353", "Планирование, подготовка, развязывание или ведение агрессивной войны"),
    ("354", "Публичные призывы к развязыванию агрессивной войны"),
    ("355", "Разработка, производство, накопление, приобретение или сбыт оружия массового поражения"),
    ("356", "Применение запрещенных средств и методов ведения войны"),
    ("357", "Геноцид"),
    ("358", "Экоцид"),
    ("359", "Наемничество"),
    ("360", "Нападение на лиц или учреждения, которые пользуются международной защитой, либо угроза его совершения"),
    ("361", "Акт международного терроризма")
)
INSERT OR IGNORE INTO codes_sentences(code_id, sentence_name, sentence_description)
SELECT cid.id, d.sentence_name, d.sentence_description
FROM cid, data AS d;

COMMIT;
-- =================== END MIGRATION ===================
